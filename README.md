# Проблемът на пътуващия търговец в ж.к. Дружба 1, София

## Идея на приложението
Приложението е вдъхновено от така наречения „проблем на пътуващия търговец“, като целта му е да намери най-краткия маршрут между зададена начална точка и точки на интерес, посещавайки всяка точка на интерес точно веднъж и после да се връща обратно на началната точка. 
Използва се предефинирана пешеходна мрежа, а началната точка и точките на интерес се задават от потребителя. Приложението е разработено за ж.к Дружба 1 в София.

## Начин на работа
Изчисляването на маршрута използва алгоритъма на Дейкстра. 
С първото кликване върху картата потребителят дефинира начална точка на маршрута, оцветена в зелено. 
Следващите натискания добавят точките на интерес, които трябва да бъдат посетени. 
С натискане на бутона „Пресметни маршрут“, маршрутът се визуализира на картата, а точките получават етикет с реда на посещаване.
Приложението може да бъде използвано за намиране на най-кратък път, когато потребителят трябва да посети повече от едно място в рамките на квартала.

## Слоеве
Слоевете, които се намират в легендата, са общо пет на брой – Точки на интерес, Изчислен маршрут, Пешеходна мрежа, Граници на ж.к. Дружба 1 и OpenStreetMap за базова карта. 
Точките на интерес и Изчисления маршрут стават активни за работа, когато вече има пресметнат маршрут, но са включени по подразбиране. 
Всяко ново пресмятане зарежда новите данни в двата слоя и премахва старите. 
Пешеходната мрежа и Границите на ж.к. Дружба 1 са слоевете, при които се очаква да няма толкова много динамичност и промени. 
Пешеходната мрежа е изключена по подразбиране, а границите – включени. 
Източникът на данни за границите на квартала е ОП „Софияплан“ (https://api.sofiaplan.bg/datasets/297 ).

Отделно приложението разполага с две мрежи за пресмятане на маршрута, като потребителят динамично може да избира коя да използва. 
Стандартно е зададена да се използва пешеходната мрежа от ОП „Софияплан“ (https://api.sofiaplan.bg/datasets/284 ), а алтернативната мрежа е изтеглена от OpenStreetMap. 
Предоставени са два варианта, защото пешеходната мрежа от ОП „Софияплан“, заема предвид и тротоарите от двете страни на някои улици като отделни обекти, което въпреки че отразява точното разположение в реалния свят, понякога удължава изчисления маршрут, тъй като мрежата не отчита възможността за пресичане от другата страна във всеки един момент, а са налични само официалните пресичания.
От друга страна, подробността на пешеходната мрежа спомага за по-точната маршрутизация. Мрежата от OpenStreetMap няма допълнително картирани тротоари и всяка улица е представена с една линейна структура.

Атрибутите на слоевете са, както следва:
- Пешеходна мрежа от ОП „Софияплан“ – id, name, type, str_class
- Пешеходна мрежа от OpenStreetmap – full_id, osm_id, osm_type, highway, name:en, name
- Точки на интерес – name, route_order
- Изчислен маршрут – name, distance_m, created_at 
(distance_m се актуализира динамично при модифициране на геометрията)

За базова карта е избрана OpenStreetMap, тъй като на нея ясно се виждат потенциални точки на интерес и потребителят лесно може да избере такива чрез базовата карта, ако не познава района.

## Функционалности
Главната функционалност на уеб приложението е пресмятането на маршрути по правилото на проблема на пътуващия търговец. 
В допълнение по време на дефинирането на точките има възможност за отмяна на последната поставена точка и отделно нулиране на маршрута. 
Нулирането може да се случи както и преди изчертаването на маршрута (докато се добавят точки) и така и като вече е пресметнат маршрута, за да се започне нова маршрутизация.
След като е пресметна маршрут има опция за добавяне на последващи точки на интерес и повторно пресмятане на същия маршрут, но с взети предвид и новите добавени точки.
При пресмятане до символите на точките на интерес се появяват етикети, показващи последователността на посещение.

Всички векторни слоеве разполагат с атрибутивна таблица, от която могат да се селектират и филтрират обекти, редакция на атрибутивна информация, запазване на промени в атрибутите, отменяне на незаписаните редакции, изтриване на обекти и изтегляне на редактирания слой във формат GeoJSON.
За слоевете с точки на интерес и изчислен маршрут бутоните за изтегляне на дадения слоя във формат GeoJSON са изведени в основния панел със слоеве, тъй като от потребителска гледна точка биха се ползвали по-често, на другите слоеве бутонът се намира в атрибутивната таблица и е активен само когато има редакции в слоя (геометрия или атрибути).
Отделно всяка атрибутивна таблица за даден слой може да се сортира по някой атрибут.

При селекцията на обект от даден слой приложението зуумва до него, а самата селекция е съпроводена и от визуален елемент – оцветяване на геометрията и оцветяване на реда с обекта в атрибутивната таблица.
В последствие селекцията може да бъде изчистена от бутона в атрибутивната таблица. Освен селекция от атрибутивната таблица е възможна и селекция по картата, съпроводена от същите визуални елементи. 
Когато един обект от даден слой е селектиран (независимо дали посредством картата или атрибутивната таблица), в основния панел на приложението се активира бутонът за редактиране на геометрията – всеки слой има свой такъв бутон. 
От друга страна, режимът на редакция на атрибутивната информация за даден слой се активира с бутон в таблицата, като редакциите се съобразяват с типа данни и не се позволява запазване на промените, ако типът не е спазен. 

Слоят с пешеходна мрежа разполага и с възможност за добавяне на нови обекти и съответно персонализиране на мрежата.
Важи и за двете налични мрежи (Софияплан и OpenStreetMap). Слоят с границите на квартала няма опция за добавяне на нови обекти, тъй като границите са представени с един полигон, използват се само за ориентация в пространството и няма смисъл да се добавят още обекти в този слой.
Въпреки това геометрията може да се модифицира и обектът да се изтрие. В слоевете с точки на интерес и изчислен маршрут по подразбиране с избора на точки и пресмятането на маршрута се добавят нови обекти.

## Стартиране на приложението
В git bash терминал, отворен в основната директория на проекта, се изпълняват следните **bash** команди.

За инсталиране на необходимите пакети:
`npm install`

За стартиране на приложението:
`npm run start`

## Структура и използвани библиотеки
Приложението се състои от три основни файла – *index.html, main.js, style.css*. 
В обобщен вид index.html отговаря за структурата на страницата, main.js контролира логиката, интерактивността и функционалностите по приложението и картата, а style.css допринася за визуалния изглед на приложението, въпреки че голяма част от стилизирането е чрез bootstrap. 

Използваните библиотеки са OpenLayers, bootstrap и bootstrap-icons. 
OpenLayers позволява внедряването на динамични карти във всяка уеб страница, използвайки JavaScript, като отговаря за зареждането на данните, създаването на инструменти за работа по картата и стиловете на слоевете.
Bootstrap прилага допълнително оформление и стилизиране на уеб приложението със своята предефинирана логика.
Bootstrap-icons предоставя различни SVG икони за съвместно използване с bootstrap, които служат за икони на част от бутоните.

В допълнение е използвано Vite като инструмент за изграждане и разработка на приложението.

